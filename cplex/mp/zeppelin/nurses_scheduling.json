{"info": {}, "config": {"looknfeel": "default", "personalizedMode": "false"}, "name": "C:\\Users\\AURELIEFolacci\\python\\workspace\\docplex\\docplex\\src\\samples\\examples\\delivery\\jupyter\\nurses_scheduling", "paragraphs": [{"settings": {"forms": {}, "params": {}}, "text": "%md\n# The Nurses Model\n\nThis tutorial includes everything you need to set up IBM Decision Optimization CPLEX Modeling for Python (DOcplex), build a Mathematical Programming model, and get its solution by solving the model on the cloud with IBM ILOG CPLEX Optimizer.\n\nWhen you finish this tutorial, you'll have a foundational knowledge of _Prescriptive Analytics_.\n\n>This notebook is part of [Prescriptive Analytics for Python](https://rawgit.com/IBMDecisionOptimization/docplex-doc/master/docs/index.html).\n\n>It requires an [installation of CPLEX Optimizers](http://ibmdecisionoptimization.github.io/docplex-doc/getting_started.html)\n\nDiscover us [here](https://developer.ibm.com/docloud)\n\n\nTable of contents:\n\n-  Describe the business problem\n*  How decision optimization (prescriptive analytics) can help\n*  Use decision optimization\n    *  Step 1: Import the library\n    -  Step 2: Model the data\n    *  Step 3: Prepare the data\n    -  Step 4: Set up the prescriptive model\n        * Define the decision variables\n        * Express the business constraints\n        * Express the objective\n        * Solve with Decision Optimization\n    *  Step 5: Investigate the solution and run an example analysis\n*  Summary\n\n****", "apps": [], "results": {"msg": [{"data": "<h1>The Nurses Model</h1>\n<p></p>\n<p>This tutorial includes everything you need to set up IBM Decision Optimization CPLEX Modeling for Python (DOcplex), build a Mathematical Programming model, and get its solution by solving the model on the cloud with IBM ILOG CPLEX Optimizer.</p>\n<p></p>\n<p>When you finish this tutorial, you'll have a foundational knowledge of <em>Prescriptive Analytics</em>.</p>\n<p></p>\n<blockquote>\n  <p>This notebook is part of <a href=\"https://rawgit.com/IBMDecisionOptimization/docplex-doc/master/docs/index.html\">Prescriptive Analytics for Python</a>.</p>\n</blockquote>\n<p></p>\n<blockquote>\n  <p>It requires an <a href=\"http://ibmdecisionoptimization.github.io/docplex-doc/getting_started.html\">installation of CPLEX Optimizers</a></p>\n</blockquote>\n<p></p>\n<p>Discover us <a href=\"https://developer.ibm.com/docloud\">here</a></p>\n<p></p>\n<p></p>\n<p>Table of contents:</p>\n<p></p>\n<ul>\n<li>Describe the business problem</li>\n</ul>\n<ul>\n<li>How decision optimization (prescriptive analytics) can help</li>\n</ul>\n<ul>\n<li>Use decision optimization</li>\n</ul>\n<pre><code>*  Step 1: Import the library\n</code></pre>\n<pre><code>-  Step 2: Model the data\n</code></pre>\n<pre><code>*  Step 3: Prepare the data\n</code></pre>\n<pre><code>-  Step 4: Set up the prescriptive model\n</code></pre>\n<pre><code>    * Define the decision variables\n</code></pre>\n<pre><code>    * Express the business constraints\n</code></pre>\n<pre><code>    * Express the objective\n</code></pre>\n<pre><code>    * Solve with Decision Optimization\n</code></pre>\n<pre><code>*  Step 5: Investigate the solution and run an example analysis\n</code></pre>\n<ul>\n<li>Summary</li>\n</ul>\n<p></p>\n<hr />\n", "type": "HTML"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": true, "language": "markdown"}, "editorMode": "ace/mode/markdown", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%md\n## Describe the business problem\n\nThis model deals with nurse scheduling. Nurses must be assigned to hospital shifts in accordance with various skill and staffing constraints.\n\nThe goal of the model is to find an efficient balance between the different objectives:\n\n* minimize the overall cost of the plan and\n* assign shifts as fairly as possible.\n", "apps": [], "results": {"msg": [{"data": "<h2>Describe the business problem</h2>\n<p></p>\n<p>This model deals with nurse scheduling. Nurses must be assigned to hospital shifts in accordance with various skill and staffing constraints.</p>\n<p></p>\n<p>The goal of the model is to find an efficient balance between the different objectives:</p>\n<p></p>\n<ul>\n<li>minimize the overall cost of the plan and</li>\n</ul>\n<ul>\n<li>assign shifts as fairly as possible.</li>\n</ul>\n", "type": "HTML"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": true, "language": "markdown"}, "editorMode": "ace/mode/markdown", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%md\n## How  decision optimization can help\n\n* Prescriptive analytics (decision optimization) technology recommends actions that are based on desired outcomes.  It takes into account specific scenarios, resources, and knowledge of past and current events. With this insight, your organization can make better decisions and have greater control of business outcomes.  \n\n* Prescriptive analytics is the next step on the path to insight-based actions. It creates value through synergy with predictive analytics, which analyzes data to predict future outcomes.  \n\n* Prescriptive analytics takes that insight to the next level by suggesting the optimal way to handle that future situation. Organizations that can act fast in dynamic conditions and make superior decisions in uncertain environments gain a strong competitive advantage.  \n<br/>\n\n<u>With prescriptive analytics, you can:</u> \n\n* Automate the complex decisions and trade-offs to better manage your limited resources.\n* Take advantage of a future opportunity or mitigate a future risk.\n* Proactively update recommendations based on changing events.\n* Meet operational goals, increase customer loyalty, prevent threats and fraud, and optimize business processes.", "apps": [], "results": {"msg": [{"data": "<h2>How  decision optimization can help</h2>\n<p></p>\n<ul>\n<li>Prescriptive analytics (decision optimization) technology recommends actions that are based on desired outcomes.  It takes into account specific scenarios, resources, and knowledge of past and current events. With this insight, your organization can make better decisions and have greater control of business outcomes.  </li>\n</ul>\n<p></p>\n<ul>\n<li>Prescriptive analytics is the next step on the path to insight-based actions. It creates value through synergy with predictive analytics, which analyzes data to predict future outcomes.  </li>\n</ul>\n<p></p>\n<ul>\n<li>Prescriptive analytics takes that insight to the next level by suggesting the optimal way to handle that future situation. Organizations that can act fast in dynamic conditions and make superior decisions in uncertain environments gain a strong competitive advantage.  </li>\n</ul>\n<p><br/></p>\n<p></p>\n<p><u>With prescriptive analytics, you can:</u> </p>\n<p></p>\n<ul>\n<li>Automate the complex decisions and trade-offs to better manage your limited resources.</li>\n</ul>\n<ul>\n<li>Take advantage of a future opportunity or mitigate a future risk.</li>\n</ul>\n<ul>\n<li>Proactively update recommendations based on changing events.</li>\n</ul>\n<ul>\n<li>Meet operational goals, increase customer loyalty, prevent threats and fraud, and optimize business processes.</li>\n</ul>\n", "type": "HTML"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": true, "language": "markdown"}, "editorMode": "ace/mode/markdown", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%md\n## Use decision optimization", "apps": [], "results": {"msg": [{"data": "<h2>Use decision optimization</h2>\n", "type": "HTML"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": true, "language": "markdown"}, "editorMode": "ace/mode/markdown", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%md\n### Step 1: Import the library\n\nRun the following code to import Decision Optimization CPLEX Modeling library.  The *DOcplex* library contains the two modeling packages, Mathematical Programming and Constraint Programming.", "apps": [], "results": {"msg": [{"data": "<h3>Step 1: Import the library</h3>\n<p></p>\n<p>Run the following code to import Decision Optimization CPLEX Modeling library.  The <em>DOcplex</em> library contains the two modeling packages, Mathematical Programming and Constraint Programming.</p>\n", "type": "HTML"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": true, "language": "markdown"}, "editorMode": "ace/mode/markdown", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%python\nimport sys\ntry:\n    import docplex.mp\nexcept:\n    raise Exception('Please install docplex. See https://pypi.org/project/docplex/')", "apps": [], "results": {"msg": [{"data": "", "type": "ANGULAR"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": false, "language": "python"}, "editorMode": "ace/mode/python", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%md\n### Step 2: Model the data\n\nInput data consists of several tables:\n\n* The Departments table lists all departments in the scope of the assignment.\n* The Skills table list all skills.\n* The Shifts table lists all shifts to be staffed. A shift contains a department, a day in the week, plus the start and end times.\n* The Nurses table lists all nurses, identified by their names.\n* The NurseSkills table gives the skills of each nurse.\n* The SkillRequirements table lists the minimum number of persons required for a given department and skill.\n* The NurseVacations table lists days off for each nurse.\n* The NurseAssociations table lists pairs of nurses who wish to work together.\n* The NurseIncompatibilities table lists pairs of nurses who do not want to work together\n.\nIn addition, the plan has to satisfy a maximum worktime for all nurses, for example 40 hours a week.", "apps": [], "results": {"msg": [{"data": "<h3>Step 2: Model the data</h3>\n<p></p>\n<p>Input data consists of several tables:</p>\n<p></p>\n<ul>\n<li>The Departments table lists all departments in the scope of the assignment.</li>\n</ul>\n<ul>\n<li>The Skills table list all skills.</li>\n</ul>\n<ul>\n<li>The Shifts table lists all shifts to be staffed. A shift contains a department, a day in the week, plus the start and end times.</li>\n</ul>\n<ul>\n<li>The Nurses table lists all nurses, identified by their names.</li>\n</ul>\n<ul>\n<li>The NurseSkills table gives the skills of each nurse.</li>\n</ul>\n<ul>\n<li>The SkillRequirements table lists the minimum number of persons required for a given department and skill.</li>\n</ul>\n<ul>\n<li>The NurseVacations table lists days off for each nurse.</li>\n</ul>\n<ul>\n<li>The NurseAssociations table lists pairs of nurses who wish to work together.</li>\n</ul>\n<ul>\n<li>The NurseIncompatibilities table lists pairs of nurses who do not want to work together</li>\n</ul>\n<p>.</p>\n<p>In addition, the plan has to satisfy a maximum worktime for all nurses, for example 40 hours a week.</p>\n", "type": "HTML"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": true, "language": "markdown"}, "editorMode": "ace/mode/markdown", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%md\n### Step 3: Prepare the data\n\nNow we need some basic data structures to store information.", "apps": [], "results": {"msg": [{"data": "<h3>Step 3: Prepare the data</h3>\n<p></p>\n<p>Now we need some basic data structures to store information.</p>\n", "type": "HTML"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": true, "language": "markdown"}, "editorMode": "ace/mode/markdown", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%python\nfrom enum import Enum\nfrom collections import namedtuple\n\n# utility to conevrt a weekday string to an index in 0..6\n_all_days = [\"monday\", \"tuesday\", \"wednesday\", \"thursday\", \"friday\", \"saturday\", \"sunday\"]\n\n\ndef day_to_day_week(day):\n    day_map = {day: d for d, day in enumerate(_all_days)}\n    return day_map[day.lower()]\n\nTWorkRules = namedtuple(\"TWorkRules\", [\"work_time_max\"])\nTVacation = namedtuple(\"TVacation\", [\"nurse\", \"day\"])\nTNursePair = namedtuple(\"TNursePair\", [\"firstNurse\", \"secondNurse\"])\nTNurseSkill = namedtuple(\"TNurseSkill\", [\"nurse\", \"skill\"])\nTSkillRequirement = namedtuple(\"TSkillRequirement\", [\"department\", \"skill\", \"required\"])\n\n\n# subclass the namedtuple to refine the str() method as the nurse's name\nclass TNurse(namedtuple(\"TNurse1\", [\"name\", \"pay_rate\"])):\n    \"\"\" A subclass to redefine the default str() of namedtuple.\n    This class is used in variable naming, so we need to redefine the str() method\n    used by variable naming.\n    \"\"\"\n\n    def __str__(self):\n        return self.name\n\n\nclass TShift(\n    namedtuple(\"TShift1\", [\"department\", \"day\", \"start_time\", \"end_time\", \"min_requirement\", \"max_requirement\"])):\n    \"\"\" specialize namedtuple to redefine its str() method\n    \"\"\"\n\n    def __str__(self):\n        # keep first two characters in departement, uppercased\n        dept2 = self.department[0:4].upper()\n        # keep 3 days of weekday\n        dayname = self.day[0:3]\n        return '%s_%s_%02d' % (dept2, dayname, self.start_time)\n    \n\nclass ShiftActivity(object):\n    @staticmethod\n    def to_abstime(day_index, time_of_day):\n        \"\"\" Convert a pair (day_index, time) into a number of hours since Monday 00:00\n\n        :param day_index: The index of the day from 1 to 7 (Monday is 1).\n        :param time_of_day: An integer number of hours.\n\n        :return:\n        \"\"\"\n        time = 24 * (day_index - 1)\n        time += time_of_day\n        return time\n\n    def __init__(self, weekday, start_time_of_day, end_time_of_day):\n        assert (start_time_of_day >= 0)\n        assert (start_time_of_day <= 24)\n        assert (end_time_of_day >= 0)\n        assert (end_time_of_day <= 24)\n\n        self._weekday = weekday\n        self._start_time_of_day = start_time_of_day\n        self._end_time_of_day = end_time_of_day\n        # conversion to absolute time.\n        start_day_index = day_to_day_week(self._weekday)\n        self.start_time = self.to_abstime(start_day_index, start_time_of_day)\n        self.day_start_time = self.to_abstime(start_day_index, 0)\n        end_day_index = start_day_index if end_time_of_day > start_time_of_day else start_day_index + 1\n        self.end_time = self.to_abstime(end_day_index, end_time_of_day)\n        assert self.end_time > self.start_time\n\n    @property\n    def duration(self):\n        return self.end_time - self.start_time\n\n    def overlaps(self, other_shift):\n        if not isinstance(other_shift, ShiftActivity):\n            return False\n        else:\n            return other_shift.end_time > self.start_time and other_shift.start_time < self.end_time\n", "apps": [], "results": {"msg": [{"data": "", "type": "ANGULAR"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": false, "language": "python"}, "editorMode": "ace/mode/python", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%md\n#### Loading data from Excel with pandas\n\nWe load the data from an Excel file using *pandas*.\nEach sheet is read into a separate *pandas* DataFrame.", "apps": [], "results": {"msg": [{"data": "<h4>Loading data from Excel with pandas</h4>\n<p></p>\n<p>We load the data from an Excel file using <em>pandas</em>.</p>\n<p>Each sheet is read into a separate <em>pandas</em> DataFrame.</p>\n", "type": "HTML"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": true, "language": "markdown"}, "editorMode": "ace/mode/markdown", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%python\nCSS = \"\"\"\nbody {\n    margin: 0;\n    font-family: Helvetica;\n}\ntable.dataframe {\n    border-collapse: collapse;\n    border: none;\n}\ntable.dataframe tr {\n    border: none;\n}\ntable.dataframe td, table.dataframe th {\n    margin: 0;\n    border: 1px solid white;\n    padding-left: 0.25em;\n    padding-right: 0.25em;\n}\ntable.dataframe th:not(:empty) {\n    background-color: #fec;\n    text-align: left;\n    font-weight: normal;\n}\ntable.dataframe tr:nth-child(2) th:empty {\n    border-left: none;\n    border-right: 1px dashed #888;\n}\ntable.dataframe td {\n    border: 2px solid #ccf;\n    background-color: #f4f4ff;\n}\n    table.dataframe thead th:first-child {\n        display: none;\n    }\n    table.dataframe tbody th {\n        display: none;\n    }\n\"\"\"", "apps": [], "results": {"msg": [{"data": "", "type": "ANGULAR"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": false, "language": "python"}, "editorMode": "ace/mode/python", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%python\nfrom IPython.core.display import HTML\nHTML('<style>{}</style>'.format(CSS))\n\nfrom IPython.display import display", "apps": [], "results": {"msg": [{"data": "", "type": "ANGULAR"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": false, "language": "python"}, "editorMode": "ace/mode/python", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%python\ntry:\n    from StringIO import StringIO\nexcept ImportError:\n    from io import StringIO", "apps": [], "results": {"msg": [{"data": "", "type": "ANGULAR"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": false, "language": "python"}, "editorMode": "ace/mode/python", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%python\n# This notebook requires pandas to work\nimport pandas as pd\n\n# Make sure that xlrd package, which is a pandas optional dependency, is installed\n# This package is required for Excel I/O\ntry:\n    import xlrd\nimport pip._internal\nexcept:\n    if hasattr(sys, 'real_prefix'):\n        #we are in a virtual env.\n        pip._internal.main(['install', 'xlrd'])\n    else:\n        pip._internal.main(['install', '--user', 'xlrd'])  \n        \ntry:\n    from urllib2 import urlopen\nexcept ImportError:\n    from urllib.request import urlopen\n\ndata_url = \"https://github.com/IBMDecisionOptimization/docplex-examples/blob/master/examples/mp/jupyter/nurses_data.xls?raw=true\"\nnurse_xls_file = pd.ExcelFile(urlopen(data_url))\n\nSkillTable = nurse_xls_file.parse('Skills')\nDeptTable  = nurse_xls_file.parse('Departments')\nShiftTable = nurse_xls_file.parse('Shifts')\nSkillRequirementTable = nurse_xls_file.parse('SkillRequirements')\nNurseTable = nurse_xls_file.parse('Nurses')\nNurseSkillTable = nurse_xls_file.parse('NurseSkills')\nNurseVacationTable = nurse_xls_file.parse('NurseVacations')\nNurseAssociationTable = nurse_xls_file.parse('NurseAssociations')\nNurseIncompatibilityTable = nurse_xls_file.parse('NurseIncompatibilities')\n\ndisplay(NurseTable)", "apps": [], "results": {"msg": [{"data": "", "type": "ANGULAR"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": false, "language": "python"}, "editorMode": "ace/mode/python", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%md\nNow, we create some additional data structures to be used for building the prescriptive model.<br>\nThe goal is to not depend on *pandas* when defining decision variables and constraints.\nThe 'nurses_pandas' notebook illustrates how to benefit from pandas to build the prescriptive model.", "apps": [], "results": {"msg": [{"data": "<p>Now, we create some additional data structures to be used for building the prescriptive model.<br></p>\n<p>The goal is to not depend on <em>pandas</em> when defining decision variables and constraints.</p>\n<p>The 'nurses_pandas' notebook illustrates how to benefit from pandas to build the prescriptive model.</p>\n", "type": "HTML"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": true, "language": "markdown"}, "editorMode": "ace/mode/markdown", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%python\nskills = [SkillTable[\"name\"][i] for i in range(len(SkillTable))]\ndepts  = [DeptTable[\"name\"][i] for i in range(len(DeptTable))]\nnurses =[TNurse(NurseTable[\"name\"][i], NurseTable[\"pay_rate\"][i]) for i in range(len(NurseTable))]\n\nnurses = [nurse for nurse in nurses if nurse.pay_rate <25 and nurse.pay_rate >15]\n# Build {nurse: [skills]} dictionary\nnurse_skills = {}\nfor nsk in NurseSkillTable.itertuples(index=False):\n    nskt= TNurseSkill(*nsk)\n    nurse_skills.setdefault(nskt.nurse, []).append(nskt.skill)\n\nshifts = [TShift(*shift_row) for shift_row in ShiftTable.itertuples(index=False)]\nskill_requirements = [TSkillRequirement(*skill_requirement_row) for skill_requirement_row in\n                      SkillRequirementTable.itertuples(index=False)]\nvacations = [TVacation(*vacation_row) for vacation_row in NurseVacationTable.itertuples(index=False)]\nnurse_associations = [TNursePair(*na) for na in NurseAssociationTable.itertuples(index=False)]\nnurse_incompatibilities = [TNursePair(*na) for na in NurseIncompatibilityTable.itertuples(index=False)]\n\n# compute shift activities (start, end, duration) and store them in a dict indexed by shifts\nshift_activities = {s: ShiftActivity(s.day, s.start_time, s.end_time) for s in shifts}\n\n# map from nurse names to nurse tuples.\nnurses_by_id = {n.name: n for n in nurses}\n\n# Work rules: max work time\nwork_rules = TWorkRules(40)", "apps": [], "results": {"msg": [{"data": "", "type": "ANGULAR"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": false, "language": "python"}, "editorMode": "ace/mode/python", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%md\n### Step 4: Set up the prescriptive model", "apps": [], "results": {"msg": [{"data": "<h3>Step 4: Set up the prescriptive model</h3>\n", "type": "HTML"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": true, "language": "markdown"}, "editorMode": "ace/mode/markdown", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%python\nfrom docplex.mp.environment import Environment\nenv = Environment()\nenv.print_information()", "apps": [], "results": {"msg": [{"data": "", "type": "ANGULAR"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": false, "language": "python"}, "editorMode": "ace/mode/python", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%md\n#### Create the DOcplex model\nThis model contains all the business constraints and defines the objective.", "apps": [], "results": {"msg": [{"data": "<h4>Create the DOcplex model</h4>\n<p>This model contains all the business constraints and defines the objective.</p>\n", "type": "HTML"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": true, "language": "markdown"}, "editorMode": "ace/mode/markdown", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%python\nfrom docplex.mp.model import Model\n\nmdl = Model(\"nurses\")", "apps": [], "results": {"msg": [{"data": "", "type": "ANGULAR"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": false, "language": "python"}, "editorMode": "ace/mode/python", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%md\n#### Define the decision variables\n\nThe basic decisions are \"which nurse works which shift\", which is modeled by binary variables for each (nurse, shift) pair.\n\nThe output of the model is, for each shift, the list of nurses that work the shift.\n\n", "apps": [], "results": {"msg": [{"data": "<h4>Define the decision variables</h4>\n<p></p>\n<p>The basic decisions are \"which nurse works which shift\", which is modeled by binary variables for each (nurse, shift) pair.</p>\n<p></p>\n<p>The output of the model is, for each shift, the list of nurses that work the shift.</p>\n<p></p>\n", "type": "HTML"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": true, "language": "markdown"}, "editorMode": "ace/mode/markdown", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%python\n# One binary variable for each pair (nurse, shift) equal to 1 if nurse n is assigned to shift s\nnurse_assignment_vars = mdl.binary_var_matrix(nurses, shifts, 'NurseAssigned')\n\n# For each nurse, allocate one variable for worktime\nnurse_work_time_vars = mdl.continuous_var_dict(nurses, lb=0, name='NurseWorkTime')\n\n# And two variables for over_average and under-average work time\nnurse_over_average_time_vars = mdl.continuous_var_dict(nurses, lb=0, name='NurseOverAverageWorkTime')\nnurse_under_average_time_vars = mdl.continuous_var_dict(nurses, lb=0, name='NurseUnderAverageWorkTime')\n\n# Finally the global average work time\naverage_nurse_work_time = mdl.continuous_var(lb=0, name='AverageWorkTime')", "apps": [], "results": {"msg": [{"data": "", "type": "ANGULAR"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": false, "language": "python"}, "editorMode": "ace/mode/python", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%md\n#### Express the business constraints\n##### First constraint: define average work time\nThe average work time over all nurses will be used in particular to calculate the over/under average work time for each nurse, and to formulate a _fairness_ rule.", "apps": [], "results": {"msg": [{"data": "<h4>Express the business constraints</h4>\n<h5>First constraint: define average work time</h5>\n<p>The average work time over all nurses will be used in particular to calculate the over/under average work time for each nurse, and to formulate a <em>fairness</em> rule.</p>\n", "type": "HTML"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": true, "language": "markdown"}, "editorMode": "ace/mode/markdown", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%python\nmdl.add_constraint(len(nurses) * average_nurse_work_time ==\n                   mdl.sum(nurse_work_time_vars[n] for n in nurses), \"average\")", "apps": [], "results": {"msg": [{"data": "", "type": "ANGULAR"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": false, "language": "python"}, "editorMode": "ace/mode/python", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%md\n##### Second constraint: compute nurse work time, average and under/over time", "apps": [], "results": {"msg": [{"data": "<h5>Second constraint: compute nurse work time, average and under/over time</h5>\n", "type": "HTML"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": true, "language": "markdown"}, "editorMode": "ace/mode/markdown", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%python\nfor n in nurses:\n    work_time_var = nurse_work_time_vars[n]\n    mdl.add_constraint(\n        work_time_var == mdl.sum(nurse_assignment_vars[n, s] * shift_activities[s].duration for s in shifts),\n        \"work_time_{0!s}\".format(n))\n\n    # Relate over/under average worktime variables to the worktime variables.\n    # The trick here is that variables have zero lower bound\n    # however, these variables are not completely defined by this constraint,\n    # only their difference is.\n    # If these variables are part of the objective, CPLEX will naturally minimize their value,\n    # as expected.\n    mdl.add_constraint(\n        work_time_var == average_nurse_work_time + nurse_over_average_time_vars[n] - nurse_under_average_time_vars[n],\n        \"average_work_time_{0!s}\".format(n))\n\n    # State the maximum work time as a constraint, so that it can be relaxed,\n    # should the problem become infeasible.\n    mdl.add_constraint(work_time_var <= work_rules.work_time_max, \"max_time_{0!s}\".format(n))", "apps": [], "results": {"msg": [{"data": "", "type": "ANGULAR"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": false, "language": "python"}, "editorMode": "ace/mode/python", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%md\n##### Third constraint: vacations\nWhen a nurse is on vacation, he or she cannot be assigned to any shift starting that day.", "apps": [], "results": {"msg": [{"data": "<h5>Third constraint: vacations</h5>\n<p>When a nurse is on vacation, he or she cannot be assigned to any shift starting that day.</p>\n", "type": "HTML"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": true, "language": "markdown"}, "editorMode": "ace/mode/markdown", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%python\nfor vac_nurse_id, vac_day in vacations:\n        vac_n = nurses_by_id.get(vac_nurse_id, -1)\n        if vac_n != -1:\n            for shift in (s for s in shifts if s.day == vac_day):\n                mdl.add_constraint(nurse_assignment_vars[vac_n, shift] == 0,\n                                     \"medium_vacations_{0!s}_{1!s}_{2!s}\".format(vac_n, vac_day, shift))", "apps": [], "results": {"msg": [{"data": "", "type": "ANGULAR"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": false, "language": "python"}, "editorMode": "ace/mode/python", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%md\n##### Fourth constraint: a nurse cannot be assigned overlapping shifts\nSome shifts overlap in time and thus cannot be assigned to the same nurse.", "apps": [], "results": {"msg": [{"data": "<h5>Fourth constraint: a nurse cannot be assigned overlapping shifts</h5>\n<p>Some shifts overlap in time and thus cannot be assigned to the same nurse.</p>\n", "type": "HTML"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": true, "language": "markdown"}, "editorMode": "ace/mode/markdown", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%python\n# Post only one constraint per couple(s1, s2)\nnumber_of_overlaps = 0\nnb_shifts = len(shifts)\nfor i1 in range(nb_shifts):\n    for i2 in range(i1 + 1, nb_shifts):\n        s1 = shifts[i1]\n        s2 = shifts[i2]\n        if shift_activities[s1].overlaps(shift_activities[s2]):\n            number_of_overlaps += 1\n            for n in nurses:\n                mdl.add_constraint(nurse_assignment_vars[n, s1] + nurse_assignment_vars[n, s2] <= 1,\n                                   \"high_overlapping_{0!s}_{1!s}_{2!s}\".format(s1, s2, n))\nprint(\"# overlapping shifts: {}\".format(number_of_overlaps))", "apps": [], "results": {"msg": [{"data": "", "type": "ANGULAR"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": false, "language": "python"}, "editorMode": "ace/mode/python", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%md\n##### Fifth constraint: enforce minimum and maximum requirements for shifts\nEach shift requires a minimum and a maximum number of nurses. \nFor each shift, the sum over all nurses of assignments to this shift\nmust be greater than or equal to the minimum requirement and lesser than or equal to the maximum requirement.", "apps": [], "results": {"msg": [{"data": "<h5>Fifth constraint: enforce minimum and maximum requirements for shifts</h5>\n<p>Each shift requires a minimum and a maximum number of nurses. </p>\n<p>For each shift, the sum over all nurses of assignments to this shift</p>\n<p>must be greater than or equal to the minimum requirement and lesser than or equal to the maximum requirement.</p>\n", "type": "HTML"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": true, "language": "markdown"}, "editorMode": "ace/mode/markdown", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%python\nfor s in shifts:\n    demand_min = s.min_requirement\n    demand_max = s.max_requirement\n    total_assigned = mdl.sum(nurse_assignment_vars[n, s] for n in nurses)\n    mdl.add_constraint(total_assigned >= demand_min,\n                       \"high_req_min_{0!s}_{1}\".format(s, demand_min))\n    mdl.add_constraint(total_assigned <= demand_max,\n                       \"medium_req_max_{0!s}_{1}\".format(s, demand_max))", "apps": [], "results": {"msg": [{"data": "", "type": "ANGULAR"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": false, "language": "python"}, "editorMode": "ace/mode/python", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%md\n##### Sixth constraint: enforce skill requirements for selected shifts\nSome shifts require at least _x_ nurses with a specified skill.", "apps": [], "results": {"msg": [{"data": "<h5>Sixth constraint: enforce skill requirements for selected shifts</h5>\n<p>Some shifts require at least <em>x</em> nurses with a specified skill.</p>\n", "type": "HTML"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": true, "language": "markdown"}, "editorMode": "ace/mode/markdown", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%python\nfor (dept, skill, required) in skill_requirements:\n    if required > 0:\n        for dsh in (s for s in shifts if dept == s.department):\n            mdl.add_constraint(mdl.sum(nurse_assignment_vars[skilled_nurse, dsh] for skilled_nurse in\n                                       (n for n in nurses if n.name in nurse_skills.keys() and \n                                        skill in nurse_skills[n.name])) >= required,\n                               \"high_required_{0!s}_{1!s}_{2!s}_{3!s}\".format(dept, skill, required, dsh))", "apps": [], "results": {"msg": [{"data": "", "type": "ANGULAR"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": false, "language": "python"}, "editorMode": "ace/mode/python", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%md\n##### Seventh constraint: associations\nSome pairs of nurses get along particularly well, so we wish to assign them together as a team. In other words, for every such pair and for each shift, both assignment variables should always be equal.\nEither both nurses work the shift, or both do not.", "apps": [], "results": {"msg": [{"data": "<h5>Seventh constraint: associations</h5>\n<p>Some pairs of nurses get along particularly well, so we wish to assign them together as a team. In other words, for every such pair and for each shift, both assignment variables should always be equal.</p>\n<p>Either both nurses work the shift, or both do not.</p>\n", "type": "HTML"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": true, "language": "markdown"}, "editorMode": "ace/mode/markdown", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%python\n# for each pair of associted nurses, their assignement variables are equal over all shifts.\nc = 0\nfor (nurse_id1, nurse_id2) in nurse_associations:\n    if nurse_id1 in nurses_by_id and nurse_id2 in nurses_by_id:\n        nurse1 = nurses_by_id[nurse_id1]\n        nurse2 = nurses_by_id[nurse_id2]\n        for s in shifts:\n            c += 1\n            ctname = 'medium_ct_nurse_assoc_{0!s}_{1!s}_{2:d}'.format(nurse_id1, nurse_id2, c)\n            mdl.add_constraint(nurse_assignment_vars[nurse1, s] == nurse_assignment_vars[nurse2, s], ctname)", "apps": [], "results": {"msg": [{"data": "", "type": "ANGULAR"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": false, "language": "python"}, "editorMode": "ace/mode/python", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%md\n##### Eighth constraint: incompatibilities\nSimilarly, certain pairs of nurses do not get along well, and we want to avoid having them together on a shift.<br>\nIn other words, for each shift, both nurses of an incompatible pair cannot be assigned together to the shift.", "apps": [], "results": {"msg": [{"data": "<h5>Eighth constraint: incompatibilities</h5>\n<p>Similarly, certain pairs of nurses do not get along well, and we want to avoid having them together on a shift.<br></p>\n<p>In other words, for each shift, both nurses of an incompatible pair cannot be assigned together to the shift.</p>\n", "type": "HTML"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": true, "language": "markdown"}, "editorMode": "ace/mode/markdown", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%python\n# For each pair of incompatible nurses, the sum of assigned variables is less than one\nc = 0\nfor (nurse_id1, nurse_id2) in nurse_incompatibilities:\n    if nurse_id1 in nurses_by_id and nurse_id2 in nurses_by_id:\n        nurse1 = nurses_by_id[nurse_id1]\n        nurse2 = nurses_by_id[nurse_id2]\n        for s in shifts:\n            c += 1\n            ctname = 'medium_ct_nurse_incompat_{0!s}_{1!s}_{2:d}'.format(nurse_id1, nurse_id2, c)\n            mdl.add_constraint(nurse_assignment_vars[nurse1, s] + nurse_assignment_vars[nurse2, s] <= 1, ctname)", "apps": [], "results": {"msg": [{"data": "", "type": "ANGULAR"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": false, "language": "python"}, "editorMode": "ace/mode/python", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%md\n#### Express the objective\nThe objective mixes different (and contradictory) KPIs. \n\nThe first KPI is the total salary cost, computed as the sum of work times over all nurses, weighted by pay rate.<br>\nThe second KPI is the total number of assignments (nurse, shift).<br>\nThe third KPI is the average total work time over all nurses.<br>\nThe fourth KPI represents the total number of hours that is above the average work time (summed over all nurses), while the fifth KPI represents the total number of hours that is below this average.\n<br>\nFinally, the last KPI is a measure of fairness, which is evaluated as the total deviation from the average work time.", "apps": [], "results": {"msg": [{"data": "<h4>Express the objective</h4>\n<p>The objective mixes different (and contradictory) KPIs. </p>\n<p></p>\n<p>The first KPI is the total salary cost, computed as the sum of work times over all nurses, weighted by pay rate.<br></p>\n<p>The second KPI is the total number of assignments (nurse, shift).<br></p>\n<p>The third KPI is the average total work time over all nurses.<br></p>\n<p>The fourth KPI represents the total number of hours that is above the average work time (summed over all nurses), while the fifth KPI represents the total number of hours that is below this average.</p>\n<p><br></p>\n<p>Finally, the last KPI is a measure of fairness, which is evaluated as the total deviation from the average work time.</p>\n", "type": "HTML"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": true, "language": "markdown"}, "editorMode": "ace/mode/markdown", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%python\ntotal_number_of_assignments = mdl.sum(nurse_assignment_vars[n,s] for n in nurses for s in shifts)\nnurse_costs = [nurse_assignment_vars[n, s] * n.pay_rate * shift_activities[s].duration for n in nurses for s in shifts]\ntotal_salary_cost = mdl.sum(nurse_costs)\nmdl.add_kpi(total_salary_cost, \"Total salary cost\")\nmdl.add_kpi(total_number_of_assignments, \"Total number of assignments\")\nmdl.add_kpi(average_nurse_work_time)\n\ntotal_over_average_worktime = mdl.sum(nurse_over_average_time_vars[n] for n in nurses)\ntotal_under_average_worktime = mdl.sum(nurse_under_average_time_vars[n] for n in nurses)\nmdl.add_kpi(total_over_average_worktime, \"Total over-average worktime\")\nmdl.add_kpi(total_under_average_worktime, \"Total under-average worktime\")\n\ntotal_fairness = total_over_average_worktime + total_under_average_worktime\nmdl.add_kpi(total_fairness, \"Total fairness\")\n\nmdl.print_information()", "apps": [], "results": {"msg": [{"data": "", "type": "ANGULAR"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": false, "language": "python"}, "editorMode": "ace/mode/python", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%md\n##### Minimizing objective\nThe goal is to minimize the non-weighted sum of the _total salary cost_, _fairness_ and _total number of assignment_.<br>\nThis is accomplished using the `Model.minimize()` method.<br>\n\nThis definition is arbitrary and could be revised. For instance, one could emphasize minimizing salary cost by adding a weight on this term in the objective.", "apps": [], "results": {"msg": [{"data": "<h5>Minimizing objective</h5>\n<p>The goal is to minimize the non-weighted sum of the <em>total salary cost</em>, <em>fairness</em> and <em>total number of assignment</em>.<br></p>\n<p>This is accomplished using the <code>Model.minimize()</code> method.<br></p>\n<p></p>\n<p>This definition is arbitrary and could be revised. For instance, one could emphasize minimizing salary cost by adding a weight on this term in the objective.</p>\n", "type": "HTML"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": true, "language": "markdown"}, "editorMode": "ace/mode/markdown", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%python\nmdl.minimize(total_salary_cost + total_fairness + total_number_of_assignments)", "apps": [], "results": {"msg": [{"data": "", "type": "ANGULAR"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": false, "language": "python"}, "editorMode": "ace/mode/python", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%md\n#### Solve with Decision Optimization\nNow we have everything we need to solve the model, using `Model.solve()`. The following cell solves using your local CPLEX (if any, and provided you have added it to your `PYTHONPATH` variable). \n", "apps": [], "results": {"msg": [{"data": "<h4>Solve with Decision Optimization</h4>\n<p>Now we have everything we need to solve the model, using <code>Model.solve()</code>. The following cell solves using your local CPLEX (if any, and provided you have added it to your <code>PYTHONPATH</code> variable). </p>\n", "type": "HTML"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": true, "language": "markdown"}, "editorMode": "ace/mode/markdown", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%python\n# Set Cplex mipgap to 1e-5 to enforce precision to be of the order of a unit (objective value magnitude is ~1e+5).\nmdl.parameters.mip.tolerances.mipgap = 1e-5\n\ns = mdl.solve(log_output=True)\nif not s:\n    # solve has failed, we try relaxation, based on constraint names\n    # constraints are prioritized according to their names\n    # if a name contains \"low\", it has priority LOW\n    # if a ct name contains \"medium\" it has priority MEDIUM\n    # same for HIGH\n    # if a constraint has no name or does not match any, it is not relaxable.\n    from docplex.mp.relaxer import Relaxer\n    relaxer = Relaxer(prioritizer='match', verbose=True)\n    # self.enable_trace()\n    #self.parameters.mip.tolerances.mipgap = 0.03 # 3%\n    relaxed_sol = relaxer.relax(mdl)\n    relaxed_ok = relaxed_sol is not None\n    assert relaxed_ok, \"relaxation failed\"\n    relaxer.print_information()\n\nmdl.report()", "apps": [], "results": {"msg": [{"data": "", "type": "ANGULAR"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": false, "language": "python"}, "editorMode": "ace/mode/python", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%md\n### Step 5: Investigate the solution and then run an example analysis", "apps": [], "results": {"msg": [{"data": "<h3>Step 5: Investigate the solution and then run an example analysis</h3>\n", "type": "HTML"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": true, "language": "markdown"}, "editorMode": "ace/mode/markdown", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%md\nLet's display some charts to visualize the results: a Gantt chart displaying the assignment of nurses to shifts in a Gantt chart, and another chart showing the number of assigned nurses to each department over time.", "apps": [], "results": {"msg": [{"data": "<p>Let's display some charts to visualize the results: a Gantt chart displaying the assignment of nurses to shifts in a Gantt chart, and another chart showing the number of assigned nurses to each department over time.</p>\n", "type": "HTML"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": true, "language": "markdown"}, "editorMode": "ace/mode/markdown", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%python\nmin(shift_activities, key=lambda i: shift_activities[i].day_start_time)\nmin(s.day_start_time for s in shift_activities.values())", "apps": [], "results": {"msg": [{"data": "", "type": "ANGULAR"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": false, "language": "python"}, "editorMode": "ace/mode/python", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%python\nimport matplotlib.pyplot as plt\nimport matplotlib.gridspec as gridspec\n\n# Build set of all departments and assign a color to each of them to be used in figures\ndepartments = {s.department for s in shifts}\ncolorByDepartment = {}\nfor d, c in zip(departments, ['r', 'm', 'b', 'g', 'y', 'c', 'k']):\n    colorByDepartment[d] = c\n\n# Build dictionary with number of assigned nurses for each shift\nnbAssignmentsByShift={}\nfor n in nurses:\n    for s in shifts:\n        if nurse_assignment_vars[n,s].solution_value > 0:\n            nbAssignmentsByShift[s] = nbAssignmentsByShift.get(s,0) + 1\n\n# Build a dictionary with the list of each shift corresponding to each department\nshiftsByDepartment = {}\nfor s in shifts:\n    shiftsByDepartment.setdefault(s.department, []).append(s)\n\n\n# Shared code\ndef createLabels(ax, title, xlabel, ylabel):\n    shiftInfoByDay = {s1.day : s1 for s1 in shifts}\n    try: # Python 2\n        plt.xticks([shift_activities[s].day_start_time + w * 7 * 24 for w in [0,1] for (d, s) in shiftInfoByDay.iteritems()],\n              [\"{}\".format(s.day) for w in [0,1] for (d, s) in shiftInfoByDay.iteritems()])\n    except:\n        plt.xticks([shift_activities[s].day_start_time + w * 7 * 24 for w in [0,1] for (d, s) in shiftInfoByDay.items()],\n              [\"{}\".format(s.day) for w in [0,1] for (d, s) in shiftInfoByDay.items()])\n\n    plt.xlim([min(s.day_start_time for s in shift_activities.values()) - 6,\n              max(s.day_start_time for s in shift_activities.values()) + 30])\n    ax.set_xlabel(xlabel)\n    ax.set_ylabel(ylabel)\n    ax.grid()\n    ax.set_title(title)\n\n# Plot shift assignments for each nurse\ndef displayNursesAssignmentsGantt(ax):\n    ylabels, tickloc = [], []\n    for i, n in enumerate(nurses):\n        for s in shifts:\n            if nurse_assignment_vars[n,s].solution_value > 0:\n                shift_activity = shift_activities[s]\n                ax.bar(shift_activity.start_time, 0.8,\n                       width=shift_activity.end_time - shift_activity.start_time, bottom=i + 0.1,\n                       color=colorByDepartment[s.department])\n\n        ylabels.append(\"{} (worked: {} hours)\".format(str(n), nurse_work_time_vars[n].solution_value))\n        tickloc.append(i + 0.5)\n\n    plt.ylim(0, len(nurses))\n    plt.yticks(tickloc, ylabels)\n\n    # Create labels on x/y axis\n    createLabels(ax, 'SHIFTS ASSIGNMENTS', 'DAY OF WEEK', 'NURSES')\n\n# Plot number of assigned nurses for each shift, by department\ndef displayDepartmentsAssignments(ax):\n    ylabels, tickloc = [], []\n    maxNbAssignements = max(nbAssignmentsByShift.values())\n    for i, d in enumerate(departments):\n        for s in shiftsByDepartment[d]:\n            shift_activity = shift_activities[s]\n            ax.bar(shift_activity.start_time, nbAssignmentsByShift.get(s, 0) / float(maxNbAssignements + 1),\n                   width=shift_activity.end_time - shift_activity.start_time, bottom=i + 0.5,\n                   color=colorByDepartment[s.department])\n        ylabels.append(\"{}\".format(d))\n        tickloc.append(i + 0.5)\n\n    plt.ylim(0, len(departments) + 0.5)\n    plt.yticks(tickloc, ylabels)\n\n    # Create labels on x/y axis\n    createLabels(ax, 'NUMBER OF ASSIGNED NURSES', 'DAY OF WEEK', 'DEPARTMENTS')\n\n# Display figures as two sub-plots so that they are vertically aligned\nfig = plt.figure(figsize=[14,12])\ngs = gridspec.GridSpec(2, 1, height_ratios=[3,1])\n\nax = plt.subplot(gs[0])\ndisplayNursesAssignmentsGantt(ax)\n\nax = plt.subplot(gs[1])\ndisplayDepartmentsAssignments(ax)", "apps": [], "results": {"msg": [{"data": "", "type": "ANGULAR"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": false, "language": "python"}, "editorMode": "ace/mode/python", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%md\n## Summary\n\nYou learned how to set up and use IBM Decision Optimization CPLEX Modeling for Python to formulate a Mathematical Programming model and solve it with IBM Decision Optimization on Cloud.", "apps": [], "results": {"msg": [{"data": "<h2>Summary</h2>\n<p></p>\n<p>You learned how to set up and use IBM Decision Optimization CPLEX Modeling for Python to formulate a Mathematical Programming model and solve it with IBM Decision Optimization on Cloud.</p>\n", "type": "HTML"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": true, "language": "markdown"}, "editorMode": "ace/mode/markdown", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%md\n## References\n* [CPLEX Modeling for Python documentation](https://rawgit.com/IBMDecisionOptimization/docplex-doc/master/docs/index.html)\n* [Decision Optimization on Cloud](https://developer.ibm.com/docloud/)\n* Need help with DOcplex or to report a bug? Please go [here](https://developer.ibm.com/answers/smartspace/docloud).\n* Contact us at dofeedback@wwpdl.vnet.ibm.com.", "apps": [], "results": {"msg": [{"data": "<h2>References</h2>\n<ul>\n<li><a href=\"https://rawgit.com/IBMDecisionOptimization/docplex-doc/master/docs/index.html\">CPLEX Modeling for Python documentation</a></li>\n</ul>\n<ul>\n<li><a href=\"https://developer.ibm.com/docloud/\">Decision Optimization on Cloud</a></li>\n</ul>\n<ul>\n<li>Need help with DOcplex or to report a bug? Please go <a href=\"https://developer.ibm.com/answers/smartspace/docloud\">here</a>.</li>\n</ul>\n<ul>\n<li>Contact us at dofeedback@wwpdl.vnet.ibm.com.</li>\n</ul>\n", "type": "HTML"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": true, "language": "markdown"}, "editorMode": "ace/mode/markdown", "colWidth": 12, "enabled": true, "results": {}}}, {"settings": {"forms": {}, "params": {}}, "text": "%md\nCopyright \u00a9 2017-2018 IBM. IPLA licensed Sample Materials.", "apps": [], "results": {"msg": [{"data": "<p>Copyright \u00a9 2017-2018 IBM. IPLA licensed Sample Materials.</p>\n", "type": "HTML"}], "code": "SUCCESS"}, "user": "anonymous", "config": {"editorSetting": {"editOnDblClick": true, "language": "markdown"}, "editorMode": "ace/mode/markdown", "colWidth": 12, "enabled": true, "results": {}}}]}